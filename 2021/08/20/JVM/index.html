

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
  <title>jvm笔记 - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>李正</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="jvm笔记">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-08-20 00:00" pubdate>
        August 20, 2021 am
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      7.9k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      97
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">jvm笔记</h1>
            
            <div class="markdown-body">
              <h1 id="JVM"><a href="#JVM" class="headerlink" title="JVM"></a>JVM</h1><p>经典面试：</p>
<blockquote>
<p>1.jvm的理解？jdk1.8jvm和之前的变化更新</p>
<p>2.什么是OOM(OUT OF MEMORY),什么是栈溢出？如何分析</p>
<p>3.常用调优参数有哪些</p>
<p>4.内存快照如何抓取，怎么分析Dump文件？</p>
<p>5.类加载器， 双亲委派机制</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u012485165/article/details/81079145">JVM常见面试题_u012485165的博客-CSDN博客_jvm面试题</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/zgpeace/article/details/108361686">什么是java OOM Out Of Memory 内存溢出？如何分析及解决oom问题？_架构师易筋-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_18657175/article/details/89366499">问十一：JVM调优常用配置参数有哪些？_向代码提问-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_35717340/article/details/114218083">java 内存快照怎么看_jvm内存快照dump文件太大，怎么分析_瓦克五的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xmh_sxh_1314/article/details/105588513">jvm类加载详解_xmh_sxh_1314的博客-CSDN博客_jvm类加载</a></p>
</blockquote>
<h2 id="1、jvm位置"><a href="#1、jvm位置" class="headerlink" title="1、jvm位置"></a>1、jvm位置</h2><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210514234415886.png" srcset="/img/loading.gif" lazyload alt="image-20210514234415886"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515155317484.png" srcset="/img/loading.gif" lazyload alt="image-20210515155317484"></p>
<p>在JDK的安装目录里你可以找到jre目录，里面有两个文件夹bin和lib,</p>
<p>在这里可以认为bin里的就是jvm，</p>
<p>lib中则是jvm工作所需要的类库，</p>
<p>而jvm(bin)和lib和起来就称为jre.</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210514235011614.png" srcset="/img/loading.gif" lazyload alt="image-20210514235011614"></p>
<p><strong>legal</strong>:该路径存放了JDK各模块的授权文档</p>
<p>include ：java和jvm交互的头文件</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210514235829745.png" srcset="/img/loading.gif" lazyload alt="image-20210514235829745"></p>
<h3 id="三种JVM"><a href="#三种JVM" class="headerlink" title="三种JVM"></a>三种JVM</h3><p>1、Sun公司HotSpot Java Hotspot™ 64-Bit Server VM (build 25.181-b13,mixed mode)<br>2、BEA JRockit</p>
<ul>
<li>最快的JVM</li>
<li>目前：Oracle JRockit </li>
</ul>
<p>3、IBM J9VM</p>
<ul>
<li>垃圾回收算法很突出</li>
<li>能保证应用程序在绝大多数情况下实时运行（停顿不超过3毫秒）。</li>
<li>使用人数较少</li>
</ul>
<p>我们目前学习都是: ==Hotspot==</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515152148590.png" srcset="/img/loading.gif" lazyload alt="image-20210515152148590"></p>
<p>堆</p>
<h2 id="2、jvm体系结构"><a href="#2、jvm体系结构" class="headerlink" title="2、jvm体系结构"></a>2、jvm体系结构</h2><h4 id="完整架构图"><a href="#完整架构图" class="headerlink" title="完整架构图"></a>完整架构图</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/architecture.png" srcset="/img/loading.gif" lazyload alt="architecture"></p>
<h4 id="手绘架构图"><a href="#手绘架构图" class="headerlink" title="手绘架构图"></a>手绘架构图</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515160456564.png" srcset="/img/loading.gif" lazyload alt="image-20210515160456564"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515155801558.png" srcset="/img/loading.gif" lazyload alt="image-20210515155801558"></p>
<h4 id="构成："><a href="#构成：" class="headerlink" title="构成："></a>构成：</h4><ol>
<li>==类加载器子系统==</li>
<li>==运行时数据区==</li>
<li>==执行引擎(Execution Engine)==</li>
</ol>
<h4 id="注意："><a href="#注意：" class="headerlink" title="注意："></a>注意：</h4><ol>
<li><strong>==第三方插件在执行引擎（Execution Engine）上操作或类加载器上操作==<strong>如</strong>Lombok</strong></li>
</ol>
<h2 id="3、类加载器"><a href="#3、类加载器" class="headerlink" title="3、类加载器"></a>3、类加载器</h2><h4 id="Class类"><a href="#Class类" class="headerlink" title="Class类"></a>Class类</h4><h5 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321170145363.png" srcset="/img/loading.gif" lazyload alt="image-20210321170145363"></p>
<h5 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321170239300.png" srcset="/img/loading.gif" lazyload alt="image-20210321170239300"></p>
<ul>
<li><p>一个类在内存中只有一个class对象</p>
</li>
<li><p>一个类被加载后，类的整个结构会被封装到class对象中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Class&lt;Car&gt; carClass = Car.class;<br>        Car car1 = <span class="hljs-keyword">new</span> Car();<br>        Car car2 = <span class="hljs-keyword">new</span> Car();<br>        Car car3 = <span class="hljs-keyword">new</span> Car();<br>        <span class="hljs-comment">//对象是具体的多变的</span><br>        System.out.println(car1.hashCode());<br>        System.out.println(car2.hashCode());<br>        System.out.println(car3.hashCode());<br>        <span class="hljs-comment">//类是唯一的抽象的</span><br>        System.out.println(car1.getClass().hashCode());<br>        System.out.println(car2.getClass().hashCode());<br>        System.out.println(car3.getClass().hashCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515170401389.png" srcset="/img/loading.gif" lazyload alt="image-20210515170401389"></p>
</li>
</ul>
<h5 id="获取方法"><a href="#获取方法" class="headerlink" title="获取方法"></a>获取方法</h5><ul>
<li><p>static Class.forName(包名)： ClassNotFoundException异常</p>
</li>
<li><p>Class&lt;?&gt; getClass()  类的实例调用</p>
</li>
<li><p>类名.class   最可靠，性能最高</p>
</li>
<li><p>基本类型包装类：TYPE</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GetClassMethod</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> ClassNotFoundException </span>&#123;<br>        Person person = <span class="hljs-keyword">new</span> Student();<br>        System.out.println(<span class="hljs-string">&quot;这个人&quot;</span>+person.name);<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        方式一：Class.forName(包名)</span><br><span class="hljs-comment">         */</span><br>        Class c1 = Class.forName(<span class="hljs-string">&quot;com.jkxljc.reflection.Student&quot;</span>);<br>        System.out.println(c1.hashCode());<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        方式二：Class&lt;?&gt; getClass()</span><br><span class="hljs-comment">         */</span><br>        Class c2 = person.getClass();<br>        System.out.println(c2.hashCode());<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">         方式三：类名.class</span><br><span class="hljs-comment">         */</span><br>        Class c3 = Student.class;<br>        System.out.println(c3.hashCode());<br>        <span class="hljs-comment">/*</span><br><span class="hljs-comment">        方法四：基本类型包装类：TYPE</span><br><span class="hljs-comment">         */</span><br>        Class&lt;Integer&gt; c4 = Integer.TYPE;<br>        System.out.println(c4.hashCode());<br>        System.out.println(c4);<br>         <span class="hljs-comment">//获取父类class对象</span><br>        Class c5 = c2.getSuperclass();<br>        System.out.println(c5);<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span></span>&#123;<br>    <span class="hljs-keyword">public</span> String name;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">toString</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Person&#123;&quot;</span> +<br>                <span class="hljs-string">&quot;name=&#x27;&quot;</span> + name + <span class="hljs-string">&#x27;\&#x27;&#x27;</span> +<br>                <span class="hljs-string">&#x27;&#125;&#x27;</span>;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Student</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Person</span></span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Student</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name=<span class="hljs-string">&quot;学生&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h5 id="拥有class对象的类型"><a href="#拥有class对象的类型" class="headerlink" title="拥有class对象的类型"></a>拥有class对象的类型</h5><ol>
<li><p>class：外嵌类(embedded class)，成员(成员内部类，静态内部类)，局部内部类，匿名内部类</p>
</li>
<li><p>interface：接口</p>
</li>
<li><p>数组：[] array</p>
</li>
<li><p>enu：枚举</p>
</li>
<li><p>annotation：注解@interface</p>
</li>
<li><p>primitive type：基本数据类型</p>
</li>
<li><p>void ：类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">getType</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Class c1 = Object.class;<span class="hljs-comment">//类</span><br>        Class c2 = Comparable.class;<span class="hljs-comment">//接口</span><br>        Class c3 = <span class="hljs-keyword">int</span>[].class;<span class="hljs-comment">//一维数组</span><br>        Class c4 = <span class="hljs-keyword">int</span>[][].class;<span class="hljs-comment">//二维数组</span><br>        Class c5 = ElementType.class;<span class="hljs-comment">//枚举类型</span><br>        Class c6 = Integer.class;<span class="hljs-comment">//基本数据类型</span><br>        Class c7 = <span class="hljs-keyword">void</span>.class;<span class="hljs-comment">//void</span><br>        Class c8 = Class.class;<span class="hljs-comment">//Class</span><br>        System.out.println(c1);<br>        System.out.println(c2);<br>        System.out.println(c3);<br>        System.out.println(c4);<br>        System.out.println(c5);<br>        System.out.println(c6);<br>        System.out.println(c7);<br>        System.out.println(c8);<br><span class="hljs-comment">//只要元素类型和维度一致，就是同一个class</span><br>        <span class="hljs-keyword">int</span>[] a=<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">10</span>];<br>        <span class="hljs-keyword">int</span>[] b=<span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[<span class="hljs-number">100</span>];<br>        System.out.println(a.getClass().hashCode());<br>        System.out.println(b.getClass().hashCode());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ol>
<h4 id="内存分析："><a href="#内存分析：" class="headerlink" title="内存分析："></a>内存分析：</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321174216456.png" srcset="/img/loading.gif" lazyload alt="image-20210321174216456"></p>
<ul>
<li>方法区是特殊的堆</li>
</ul>
<h4 id="类的加载过程："><a href="#类的加载过程：" class="headerlink" title="类的加载过程："></a>类的加载过程：</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515171428700.png" srcset="/img/loading.gif" lazyload alt="image-20210515171428700"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321174432539.png" srcset="/img/loading.gif" lazyload alt="image-20210321174432539"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321174537637.png" srcset="/img/loading.gif" lazyload alt="image-20210321174537637"></p>
<h5 id="类的初始化："><a href="#类的初始化：" class="headerlink" title="类的初始化："></a>类的初始化：</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321175722487.png" srcset="/img/loading.gif" lazyload alt="image-20210321175722487"></p>
<h4 id="作用："><a href="#作用：" class="headerlink" title="作用："></a>作用：</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/%E7%B1%BB%E5%8A%A0%E8%BD%BD.png" srcset="/img/loading.gif" lazyload alt="类加载"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321180111965.png" srcset="/img/loading.gif" lazyload alt="image-20210321180111965"></p>
<h5 id="加载class文件"><a href="#加载class文件" class="headerlink" title="加载class文件"></a>加载class文件</h5><h4 id="new的全过程"><a href="#new的全过程" class="headerlink" title="new的全过程"></a>new的全过程</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515165036739.png" srcset="/img/loading.gif" lazyload alt="image-20210515165036739"></p>
<h4 id="类加载器分类"><a href="#类加载器分类" class="headerlink" title="类加载器分类"></a>类加载器分类</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321180222575.png" srcset="/img/loading.gif" lazyload alt="image-20210321180222575"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210321195912116.png" srcset="/img/loading.gif" lazyload alt="image-20210321195912116"></p>
<h5 id="1、JVM自带加载器"><a href="#1、JVM自带加载器" class="headerlink" title="1、JVM自带加载器"></a>1、JVM自带加载器</h5><h5 id="2、启动类-根-加载器——Bootstrap"><a href="#2、启动类-根-加载器——Bootstrap" class="headerlink" title="2、启动类(根)加载器——Bootstrap"></a>2、启动类(根)加载器——Bootstrap</h5><ul>
<li>rt.jar包下</li>
</ul>
<h5 id="3、扩展类加载器——Exclus"><a href="#3、扩展类加载器——Exclus" class="headerlink" title="3、扩展类加载器——Exclus"></a>3、扩展类加载器——Exclus</h5><ul>
<li>ext下</li>
</ul>
<h5 id="4、应用程序加载器-系统-—App"><a href="#4、应用程序加载器-系统-—App" class="headerlink" title="4、应用程序加载器(系统)—App"></a>4、应用程序加载器(系统)—App</h5><h5 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Car</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Class&lt;Car&gt; carClass = Car.class;<br>        <span class="hljs-comment">//系统App加载器 sun.misc.Launcher$AppClassLoader@18b4aac2</span><br>        System.out.println(carClass.getClassLoader());<br>        <span class="hljs-comment">//扩展类加载器--sun.misc.Launcher$ExtClassLoader@1b6d3586</span><br>        System.out.println(carClass.getClassLoader().getParent());<br>        <span class="hljs-comment">//启动类(根)加载器——Bootstrap--无法获得但存在---null  rt.jar</span><br>        System.out.println(carClass.getClassLoader().getParent().getParent());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//获取系统加载器---sun.misc.Launcher$AppClassLoader@18b4aac2</span><br>      ClassLoader systemClassLoader = ClassLoader.getSystemClassLoader();<br>      System.out.println(systemClassLoader);<br>      <span class="hljs-comment">//扩展类加载器---sun.misc.Launcher$ExtClassLoader@1b6d3586</span><br>      ClassLoader parent = systemClassLoader.getParent();<br>      System.out.println(parent);<br>      <span class="hljs-comment">//获取根加载器(引导类)   c/c++ 无法查看</span><br>      ClassLoader root = parent.getParent();<br>      System.out.println(root);<span class="hljs-comment">//null</span><br>      <span class="hljs-comment">//测试当前类的加载器---系统加载器---sun.misc.Launcher$AppClassLoader@18b4aac2</span><br>      ClassLoader classLoader = Class.forName(<span class="hljs-string">&quot;com.jkxljc.reflection.GetLoader&quot;</span>).getClassLoader();<br>      System.out.println(classLoader);<br>      <span class="hljs-comment">//测试jdk内置的类--根加载器(引导类)   c/c++ 无法查看</span><br>      ClassLoader jdkClassLoader = Class.forName(<span class="hljs-string">&quot;java.lang.String&quot;</span>).getClassLoader();<br>      System.out.println(jdkClassLoader);<br>      <span class="hljs-comment">//测试系统类加载器可以获得的路径</span><br>      String property = System.getProperty(<span class="hljs-string">&quot;java.class.path&quot;</span>);<br>      System.out.println(property);<br></code></pre></td></tr></table></figure>

<h4 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/classloader.png" srcset="/img/loading.gif" lazyload alt="classloader"></p>
<p>==<strong>一个自己定义的类，要想加载，它会向类加载器发送请求，</strong>==</p>
<p>==<strong>类加载请i收到请求后，会向上委托给父类加载器完成，一直向上委托直到启动类加载器(根)，</strong>==</p>
<p>==<strong>启动加载器检查是否可以加载此类，(rt.jar包下找)，可以就使用根加载器加载，否则抛出异常，通知子加载器加载</strong>==</p>
<p>如果父类加载器有这个类， 自己写的就失效了，监测安全性</p>
<ul>
<li>防止重复加载同一个<code>.class</code>。通过委托去向上面问一问，加载过了，就不用再加载一遍。保证数据安全</li>
<li>保证核心<code>.class</code>不能被篡改。通过委托方式，不会去篡改核心<code>.class</code>，即使篡改也不会去加载，即使加载也不会是同一个<code>.class</code>对象了。</li>
<li>不同的加载器加载同一个<code>.class</code>也不是同一个<code>Class</code>对象。这样保证了<code>Class</code>执行安全。</li>
</ul>
<h2 id="4、沙箱安全机制"><a href="#4、沙箱安全机制" class="headerlink" title="4、沙箱安全机制"></a>4、沙箱安全机制</h2><p><strong>==Java安全模型的核心就是Java沙箱(sandbox) ,==</strong></p>
<h3 id="简述："><a href="#简述：" class="headerlink" title="简述："></a>简述：</h3><ul>
<li><p>沙箱是一个限制程序运行的环境。</p>
</li>
<li><p>沙箱机制就是将Java代码限定在虚拟机(JVM)特定的运行范围中，并且严格限制代码对本地系统资源访问，通过这样的措施来保证对代码的有效隔离，防止对本地系统造成破坏。</p>
</li>
<li><p>**==沙箱主要限制系统资源访问==**，</p>
<ul>
<li>系统资源包括：CPU、内存、文件系统、网络。</li>
<li>不同级别的沙箱对这些资源访问的限制也可以不一样。</li>
</ul>
</li>
<li><p>所有的Java程序运行都可以指定沙箱，可以定制安全策略。</p>
</li>
<li><p>在Java中将执行程序分成本地代码和远程代码两种，</p>
<ul>
<li>本地代码默认视为可信任的，而远程代码则被看作是不受信的。</li>
<li>对于授信的本地代码,可以访问一切本地资源。而对于非授信的远程代码在早期的Java实现中，安全依赖于沙箱Sandbox)机制。</li>
</ul>
</li>
</ul>
<h3 id="安全模型："><a href="#安全模型：" class="headerlink" title="安全模型："></a>安全模型：</h3><h4 id="JDK1-0安全模型"><a href="#JDK1-0安全模型" class="headerlink" title="JDK1.0安全模型"></a>JDK1.0安全模型</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/jdk1.png" srcset="/img/loading.gif" lazyload alt="jdk1"></p>
<ul>
<li>但如此严格的安全机制也给程序的功能扩展带来障碍，</li>
<li>比如当用户希望远程代码访问本地系统的文件时候，就无法实现</li>
</ul>
<h4 id="JDK1-1安全模型"><a href="#JDK1-1安全模型" class="headerlink" title="JDK1.1安全模型"></a>JDK1.1安全模型</h4><ul>
<li><p>相对于jdk1.0增加了安全策略，允许用户指定代码对本地资源的访问权限。如下图所示</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/jdk2.png" srcset="/img/loading.gif" lazyload alt="jdk2"></p>
</li>
</ul>
<h4 id="JDK1-2安全模型"><a href="#JDK1-2安全模型" class="headerlink" title="JDK1.2安全模型"></a>JDK1.2安全模型</h4><ul>
<li><p>再次改进了安全机制，增加了**==代码签名==**。</p>
</li>
<li><p>不论本地代码或是远程代码，都会按照用户的安全策略设定，</p>
</li>
<li><p>由类加载器加载到虚拟机中权限不同的运行空间，来实现差异化的代码执行权限控制</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/jdk3%E3%80%81.png" srcset="/img/loading.gif" lazyload alt="jdk3、"></p>
</li>
</ul>
<h4 id="jdk-1-6安全模型"><a href="#jdk-1-6安全模型" class="headerlink" title="jdk 1.6安全模型"></a>jdk 1.6安全模型</h4><ul>
<li><p>引入了域(Domain)的概念。</p>
</li>
<li><p>JVM会把所有代码加载到不同的系统域和应用域,</p>
<ul>
<li>系统域部分专门负责与关键资源进行交互，</li>
<li>各个应用域部分则通过系统域的部分代理来对各种需要的资源进行访问。</li>
</ul>
</li>
<li><p>虚拟机中不同的受保护域(Protected Domain),对应不一样的权限(Permission)。</p>
</li>
<li><p>存在于不同域中的类文件就具有了当前域的全部权限，如下图所示</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/JDK6.png" srcset="/img/loading.gif" lazyload alt="JDK6"></p>
</li>
</ul>
<h3 id="沙箱的基本组件"><a href="#沙箱的基本组件" class="headerlink" title="沙箱的基本组件"></a>沙箱的基本组件</h3><h4 id="字节码校验器-bytecode-verifier"><a href="#字节码校验器-bytecode-verifier" class="headerlink" title="字节码校验器(bytecode verifier) :"></a>字节码校验器(bytecode verifier) :</h4><ul>
<li>确保Java类文件遵循Java语言规范。这样可以帮助Java程序实现内存保护。</li>
<li>==<strong>但并不是所有的类文件都会经过字节码校验，比如核心类。</strong>==</li>
</ul>
<h4 id="类裝载器-class-loader"><a href="#类裝载器-class-loader" class="headerlink" title="类裝载器(class loader) :"></a>类裝载器(class loader) :</h4><h5 id="其中类装载器在3个方面对Java沙箱起作用"><a href="#其中类装载器在3个方面对Java沙箱起作用" class="headerlink" title="其中类装载器在3个方面对Java沙箱起作用"></a>其中类装载器在3个方面对Java沙箱起作用</h5><ol>
<li>它防止恶意代码去干涉善意的代码;//双亲委派</li>
<li>它守护了被信任的类库边界;</li>
<li>它将代码归入保护域,确定了代码可以进行哪些操作。</li>
</ol>
<p>虚拟机为不同的类加载器载入的类提供不同的命名空间，命名空间由一系列唯一的名称组成， </p>
<p>每一个被装载的类将有一个名字，这个命名空间是由Java虚拟机为每一个类装载器维护的，它们互相之间甚至不可见。<br>类装载器采用的机制是==双亲委派==模式。</p>
<ol>
<li>从最内层JVM自带类加载器开始加载,外层恶意同名类得不到加载从而无法使用;</li>
<li>由于严格通过包来区分了访问域,外层恶意的类通过内置代码也无法获得权限访问到内层类，破坏代码就自然无法生效。</li>
</ol>
<h4 id="存取控制器-access-controller"><a href="#存取控制器-access-controller" class="headerlink" title="存取控制器(access controller) :"></a>存取控制器(access controller) :</h4><ul>
<li>存取控制器可以控制核心API对操作系统的存取权限==，而这个控制的策略设定,可以由用户指定。==</li>
</ul>
<h4 id="安全管理器-security-manager"><a href="#安全管理器-security-manager" class="headerlink" title="安全管理器(security manager) :"></a>安全管理器(security manager) :</h4><ul>
<li>是==核心API和操作系统==之间的主要接口。实现权限控制，比存取控制器优先级高。</li>
</ul>
<h4 id="安全软件包-security-package"><a href="#安全软件包-security-package" class="headerlink" title="安全软件包(security package) :"></a>安全软件包(security package) :</h4><p> ==java.security==下的类和扩展包下的类，允许用户为自己的应用增加新的安全特性，包括:</p>
<ul>
<li>安全提供者</li>
<li>消息摘要</li>
<li>数字签名  https</li>
<li>加密鉴别</li>
</ul>
<h2 id="5、Native关键字与PC寄存器，方法区"><a href="#5、Native关键字与PC寄存器，方法区" class="headerlink" title="5、Native关键字与PC寄存器，方法区"></a>5、Native关键字与PC寄存器，方法区</h2><h3 id="5-1、native关键字"><a href="#5-1、native关键字" class="headerlink" title="5.1、native关键字"></a>5.1、native关键字</h3><h4 id="native具体做法"><a href="#native具体做法" class="headerlink" title="native具体做法"></a>native具体做法</h4><ul>
<li>凡是带了native关键字，说明java作用域已经达不到了，得去调c/c++库</li>
<li>首先进入本地方法栈，进行登记方法，然后调用JNI接口</li>
<li>在( Execution Engine )执行引擎执行的时候加载Native Libraies执行对应的方法。</li>
</ul>
<h4 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h4><h5 id="作用：-1"><a href="#作用：-1" class="headerlink" title="作用："></a>作用：</h5><ul>
<li>扩展java的使用</li>
<li>融合不同的编程语言为Java所用，它的初衷是融合C/C++程序, Java在诞生的时候是C/C++横行的时候，想要立足，必须有调用C、C++的程序，于是就在==内存中专门开辟了块标记区域：本地方法栈，登记native方法处理标记为native的代码，==</li>
<li>在( Execution Engine )执行引擎执行的时候加载Native Libraies执行对应的方法。</li>
</ul>
<h5 id="现状："><a href="#现状：" class="headerlink" title="现状："></a>现状：</h5><ul>
<li>目前该方法使用的越来越少了，除非是与硬件有关的应用， </li>
<li>比如通过Java程序驱动打印机或者Java系统管理生产设备，==在企业级应用中已经比较少见。==</li>
<li>因为现在的异构领域间通信很发达，比如可以使用Socket通信,也可以使用Web Service等等!</li>
</ul>
<h3 id="5-2、pc寄存器"><a href="#5-2、pc寄存器" class="headerlink" title="5.2、pc寄存器"></a>5.2、pc寄存器</h3><p><strong>程序计数器: Program Counter Register</strong></p>
<ul>
<li>每个线程都有一个程序计数器，是线程私有的，记住下一条jvm指令的执行地址</li>
<li>就是一个指针, 指向方法区中的方法字节码(用来存储指向像一条指令的地址， 也即将要执行的指令代码)，</li>
<li>在执行引擎读取下一条指令, ==是一个非常小的内存空间，几乎可以忽略不计==</li>
</ul>
<p><strong>特点：</strong>1.线程私有的 2.不存在内存的溢出。</p>
<h3 id="5-3、方法区–Method-Area"><a href="#5-3、方法区–Method-Area" class="headerlink" title="5.3、方法区–Method Area"></a>5.3、方法区–Method Area</h3><h4 id="代码的内存分析"><a href="#代码的内存分析" class="headerlink" title="代码的内存分析"></a>代码的内存分析</h4><h5 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Pet</span> </span>&#123;<br>    <span class="hljs-keyword">public</span> String name;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> age;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">call</span><span class="hljs-params">()</span></span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;叫一声&quot;</span>);<br>    &#125;<br>&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PetTest</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        Pet dog = <span class="hljs-keyword">new</span> Pet();<br>        dog.name=<span class="hljs-string">&quot;旺财&quot;</span>;<br>        dog.age=<span class="hljs-number">12</span>;<br>        Pet cat = <span class="hljs-keyword">new</span> Pet();<br>        cat.name=<span class="hljs-string">&quot;小慧&quot;</span>;<br>        cat.age=<span class="hljs-number">2</span>;<br>        dog.call();<br>        cat.call();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="内存图："><a href="#内存图：" class="headerlink" title="内存图："></a>内存图：</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515220439658.png" srcset="/img/loading.gif" lazyload alt="image-20210515220439658"></p>
<h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li><p>被所有线程共享,</p>
</li>
<li><p>本质是一个特殊的堆</p>
</li>
<li><p>所有字段和方法字节码，以及一些特殊方法，如构造函数,接口代码也在此定义,</p>
</li>
<li><p>简单说，所有定义的方法的信息都保存在该区域,此区域属于共享区间;</p>
</li>
<li><p><strong>静态变量或方法、常量、类信息(构造方法、接口定义，成员属性或方法)、运行时的常量池存在方法区中，</strong></p>
</li>
<li><p><strong>==但是实例变量存在堆内存中，和方法区无关==</strong></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/new2.png" srcset="/img/loading.gif" lazyload alt="new2"></p>
</li>
</ul>
<h2 id="6、栈stack"><a href="#6、栈stack" class="headerlink" title="6、栈stack"></a>6、栈stack</h2><p>程序=数据结构+算法</p>
<h3 id="概述："><a href="#概述：" class="headerlink" title="概述："></a>概述：</h3><ul>
<li>一种数据结构</li>
<li>先进后出，后进先出，类似于桶(FILO)</li>
<li>队列：先进先出(FIFO)</li>
<li>栈内存：主管程序的运行，生命周期和线程同步</li>
<li>线程结束，栈内存也就释放over</li>
<li>线程级别的</li>
<li>栈不存在垃圾回收机制–GC</li>
<li>基本数据类型包括数值+对象引用+实例的方法</li>
</ul>
<h3 id="栈溢出"><a href="#栈溢出" class="headerlink" title="栈溢出"></a>栈溢出</h3><p>栈满了: StackOverflowError</p>
<p>是个错误，不是异常</p>
<p>A调用B方法，B又调用A方法，不停的压栈，栈内存溢出</p>
<p>递归</p>
<h3 id="栈运行原理"><a href="#栈运行原理" class="headerlink" title="栈运行原理"></a>栈运行原理</h3><h4 id="栈参数"><a href="#栈参数" class="headerlink" title="栈参数"></a>栈参数</h4><p>==栈帧==</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/stack1.png" srcset="/img/loading.gif" lazyload alt="stack1"></p>
<ul>
<li>栈底部子帧指向上一个栈的方法 </li>
<li>上一个栈的父帧指向栈底部方法</li>
<li>程序正在运行的方法在栈顶</li>
</ul>
<h4 id="栈和方法区和堆的交互关系："><a href="#栈和方法区和堆的交互关系：" class="headerlink" title="==栈和方法区和堆的交互关系：=="></a><strong>==栈和方法区和堆的交互关系：==</strong></h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/stack2.png" srcset="/img/loading.gif" lazyload alt="stack2"></p>
<h4 id="对象实例化的过程"><a href="#对象实例化的过程" class="headerlink" title="==对象实例化的过程=="></a><strong>==对象实例化的过程==</strong></h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210515232127476.png" srcset="/img/loading.gif" lazyload alt="image-20210515232127476"></p>
<p>Cat cat = new Cat()的过程</p>
<ol>
<li><p>JVM会根据指定路径读取Cat.class文件，并加载进内存，有父类（如：Animal）的情况下，==会先加载父类==的.class文件（即Animal.class）。</p>
</li>
<li><p>在堆内存开辟空间，分配地址</p>
</li>
<li><p>在堆对象空间中，对对象的属性进行默认初始化。</p>
<ul>
<li>调用对应构造函数进行初始化，这个例子中，调用的就是，无参构造函数</li>
<li>在构造函数中，第一行会到调用父类中构造函数进行初始化</li>
<li>父类初始化完毕后，再对子类属性进行显示初始化</li>
</ul>
</li>
<li><p>再进行子类构造函数的特定初始化</p>
</li>
<li><p>初始化完毕后，将地址赋值给引用变量(栈)。</p>
</li>
</ol>
<p>栈中具体存的东西，如何存</p>
<p>[对象的实例化、内存布局和访问定位](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/jiuxing/p/13891618.html">[JVM第六篇–对象]对象的实例化、内存布局和访问定位 - 就行222 - 博客园 (cnblogs.com)</a>)</p>
<h2 id="7、堆-Heap"><a href="#7、堆-Heap" class="headerlink" title="7、堆(Heap)"></a>7、堆(Heap)</h2><h3 id="7-1、概述："><a href="#7-1、概述：" class="headerlink" title="7.1、概述："></a>7.1、概述：</h3><ul>
<li>一个JVM只有一个堆内存</li>
<li>堆内存大小可以共享</li>
<li>类加载器读取了类文件后，将类，方法，常量，变量，保存所有引用类型的真实对象放置堆中</li>
<li>堆中的东西使用完之后不能立即释放，通过GC线程回收释放</li>
<li>默认堆内存大小：新生代：老年代=1：2，但是可通过-XX:NewRatio来调整</li>
</ul>
<h3 id="7-2、堆内存划分"><a href="#7-2、堆内存划分" class="headerlink" title="7.2、堆内存划分"></a>7.2、堆内存划分</h3><h4 id="简略图示："><a href="#简略图示：" class="headerlink" title="简略图示："></a>简略图示：</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516153313735.png" srcset="/img/loading.gif" lazyload alt="image-20210516153313735"></p>
<p><img src="F:%5C%E8%B5%84%E6%96%99%5Cmd%5CJVM.assets%5Cimage-20210516163241167.png" srcset="/img/loading.gif" lazyload alt="image-20210516163241167"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516162950882.png" srcset="/img/loading.gif" lazyload alt="image-20210516162950882"></p>
<p>==GC垃圾回收主要在伊甸园区和养老区==</p>
<p>内存满了，OOM,堆内存不够 java.lang.OutOfMemoryError: Java heap space</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeapTest</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        String s=<span class="hljs-string">&quot;asdhjkhjl;dsjvl;k&quot;</span>;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-keyword">true</span>)&#123;<br>            s+=s+<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">888888888</span>)+<span class="hljs-keyword">new</span> Random().nextInt(<span class="hljs-number">999999999</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516153923092.png" srcset="/img/loading.gif" lazyload alt="image-20210516153923092"></p>
<p><strong>==jdk8以后，永久存储区改为元空间==</strong></p>
<h4 id="1、新生区-伊甸园区-：young-New"><a href="#1、新生区-伊甸园区-：young-New" class="headerlink" title="1、新生区(伊甸园区)：young/New"></a>1、新生区(伊甸园区)：young/New</h4><ul>
<li><p>年轻代主要存放新创建的对象，内存⼤⼩相对会⽐较⼩，垃圾回收会⽐较频繁。</p>
</li>
<li><p>年轻代分成1 个Eden Space和2个Suvivor Space（命名为A和B）。</p>
</li>
<li><p>当对象在堆创建时，将进⼊年轻代的Eden Space。垃圾回收器进⾏垃圾回收时，扫描Eden Space和A Suvivor Space，如果对象仍然存活，则 复制到B Suvivor Space，</p>
</li>
<li><p>如果B Suvivor Space已经满，则复制到Old Gen。</p>
</li>
<li><p>同时，==在扫描Suvivor Space时，如果对象已经经过了⼏次的扫描仍然存活，JVM认为其为⼀个持久化对象，则将其移到Old Gen==。</p>
</li>
<li><p>扫描完毕后，JVM将Eden Space和A Suvivor Space清空，然后交换A和B的⻆⾊（即下次垃圾 回收时会扫描Eden Space和B Suvivor Space。这么做主要是为了==减少内存碎⽚==的产⽣</p>
</li>
<li><p>类：诞生和成长的地方，甚至死亡，只有极其少的一部分才会进入养老区</p>
</li>
<li><p>伊甸园，所有的对象都是在伊甸园区new出来的； </p>
</li>
<li><p>幸存者区（0，1）:不是固定的，可互换身份（from，to）to始终为空</p>
</li>
<li><p>==经过研究，99%的对象都是临时对象==；</p>
</li>
<li><p>默认的：Eden：FROM:TO=8:1:1,但可通过-XX:SurivorRatio来调整</p>
</li>
<li><p>新生代实际可用空间为90%、</p>
</li>
</ul>
<h5 id="调换过程："><a href="#调换过程：" class="headerlink" title="调换过程："></a>调换过程：</h5><ol>
<li>新生代一个对象先判断大小，超过特定内存的对象直接进入老年代，否则走2</li>
<li>新生代的minor gc中，一个survivor区数据复制进去，另一个是空的，</li>
<li>下一次GC时候，有数据的是from，没数据的是to，gc的时候，from和Eden的数据都复制到to中，此时from和to就调换了身份，一直循环</li>
<li>3中每复制一次，所有对象年龄加1，当任意一个对象复制到一定次数，就被复制到了老年代</li>
</ol>
<h4 id="2、老年区-old"><a href="#2、老年区-old" class="headerlink" title="2、老年区 old"></a>2、老年区 old</h4><ul>
<li>年⽼代主要存放JVM认为⽣命周期⽐较⻓的对象（经过⼏次的Young Gen的垃圾回收后仍然 存在），内存⼤⼩相对会⽐较⼤，垃圾回收也相对没有那么频繁（譬如可能⼏个⼩时⼀次）。</li>
<li>年⽼代主 要采⽤压缩的⽅式来避免内存碎⽚（将存活对象移动到内存⽚的⼀边，也就是内存整理）。当然，有些 垃圾回收器（譬如CMS垃圾回收器）出于效率的原因，可能会不进⾏压缩。</li>
</ul>
<h4 id="3、永久区-perm"><a href="#3、永久区-perm" class="headerlink" title="3、永久区 perm"></a>3、永久区 perm</h4><h5 id="概述：-1"><a href="#概述：-1" class="headerlink" title="概述："></a>概述：</h5><ul>
<li><p>持久代主要存放类定义、字节码和常量等很少会变更的信息。</p>
</li>
<li><p>这个区域常驻内存的。⽤来存放==JDK⾃身携带的Class对象。lnterface元数据==，存储的是==Java 运⾏时的⼀些环境或类信息==，**==这个区域不存在垃圾回收==**。</p>
</li>
<li><p>关闭VM虚拟就会释放这个区域的内存。</p>
</li>
<li><p>OOM出现情况：</p>
<ul>
<li>⼀个启动类，加载了⼤量的第三⽅jar包。</li>
<li>Tomcat部署了太多的应⽤，</li>
<li>⼤量动态⽣成的反射 类。不断的被加载。直到内存满</li>
</ul>
</li>
</ul>
<h5 id="发展进程："><a href="#发展进程：" class="headerlink" title="发展进程："></a>发展进程：</h5><ul>
<li>jdk1.6之前(包含1.6)：永久代，==常量池在⽅法区== </li>
<li>jdk1.7 ：永久代,但是慢慢的退化了，去永久代，==常量池在堆中== </li>
<li>jdk1.8之后：⽆永久代，改名元空间(元数据区),==常量池在元空间==<ul>
<li>jdk1.8引入了一个新的native的内存区块–MetaSpace</li>
</ul>
</li>
</ul>
<h5 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h5><h6 id="代码：-1"><a href="#代码：-1" class="headerlink" title="代码："></a>代码：</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeapTest2</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        <span class="hljs-comment">// 返回虚拟机试图使⽤的最⼤内存</span><br>        <span class="hljs-keyword">long</span> max = Runtime.getRuntime().maxMemory();<br>        <span class="hljs-comment">//返回jvm初始化总内存</span><br>        <span class="hljs-keyword">long</span> total=Runtime.getRuntime().totalMemory();<br>        System.out.println(<span class="hljs-string">&quot;max=&quot;</span> + max + <span class="hljs-string">&quot;字节\t&quot;</span> + (max / (<span class="hljs-keyword">double</span>) <span class="hljs-number">1024</span> / <span class="hljs-number">1024</span>) + <span class="hljs-string">&quot;MB&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;total=&quot;</span> + total + <span class="hljs-string">&quot;字节\t&quot;</span> + (total / (<span class="hljs-keyword">double</span>)( <span class="hljs-number">1024</span> * <span class="hljs-number">1024</span>)) + <span class="hljs-string">&quot;MB&quot;</span>);<br>        <span class="hljs-comment">// 默认情况下:分配的总内存是电脑内存的1/4,⽽初始化的内存为1/64</span><br>        <span class="hljs-comment">// -Xms1024m -Xmx1024m -XX:+PrintGCDetails</span><br><span class="hljs-comment">//年轻代：305664K</span><br>    <span class="hljs-comment">//老年代：699392K</span><br>        <span class="hljs-comment">//元空间：4496K</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h6 id="配置jvm参数"><a href="#配置jvm参数" class="headerlink" title="配置jvm参数"></a>配置jvm参数</h6><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516165630833.png" srcset="/img/loading.gif" lazyload alt="image-20210516165630833"></p>
<h6 id="运行截图："><a href="#运行截图：" class="headerlink" title="运行截图："></a>运行截图：</h6><p><strong>不配置参数：默认</strong></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516182353008.png" srcset="/img/loading.gif" lazyload alt="image-20210516182353008"></p>
<p><strong>配置参数：</strong></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516165659359.png" srcset="/img/loading.gif" lazyload alt="image-20210516165659359"></p>
<h5 id="注意：-1"><a href="#注意：-1" class="headerlink" title="注意："></a>注意：</h5><ul>
<li><p>元空间：逻辑上存在，物理上不存在；</p>
</li>
<li><p>有时候也可称为非堆，但仍是堆</p>
</li>
<li><p>永久代(perm gen)Hotpot虚拟机特有的概念</p>
</li>
<li><p>jdk1.8之后，jvm调优不用考虑永久代(元空间),元空间基本不会报OOM</p>
</li>
<li><p>只受系统内存限制</p>
</li>
</ul>
<h4 id="4、对象进入tenured的条件"><a href="#4、对象进入tenured的条件" class="headerlink" title="4、对象进入tenured的条件"></a>4、对象进入tenured的条件</h4><p><strong>1、对象经历了15次 Minor GC 依旧存活 (默认值 -XX:MaxTenuringThreshold = 15)</strong></p>
<p><strong>2、Survivor区中 同龄对象大小超过Survivor区空间的50%,大于此年龄的对象会进入老年代 (动态对象年龄判定) (其实是这个年龄以及低于这个年龄的对象占据超过Survivor 50% 1+2+3大于50% 则大于等于3岁的对象会进入老年代)</strong></p>
<p>此处可以参考<strong>：</strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/u014493323/article/details/82921740">https://blog.csdn.net/u014493323/article/details/82921740</a></p>
<p><strong>3、Minor GC后对象大小大于Survivor大小，会进入老年代 (空间担保机制)</strong></p>
<p><strong>4、大对象直接进入老年代 (-XX:PretenureSizeThreshold=1M 只对Serial和ParNew两款收集器有效)</strong></p>
<h3 id="7-3、堆内存调优"><a href="#7-3、堆内存调优" class="headerlink" title="7.3、堆内存调优"></a>7.3、堆内存调优</h3><h4 id="常见参数："><a href="#常见参数：" class="headerlink" title="常见参数："></a>常见参数：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java">-Xms设置初始化内存分配⼤⼩,<span class="hljs-number">1</span>/<span class="hljs-number">64</span><br>-Xmx设置最⼤分配内存,默认<span class="hljs-number">1</span>/<span class="hljs-number">4</span><br>-XX:+PrintGCDetails <span class="hljs-comment">//打印GC垃圾回收信息</span><br>-XX:+HeapDumpOnOutOfMemoryError <span class="hljs-comment">//oom DUMP</span><br>-Xms1m -Xmx8m -XX:+HeapDumpOnOutOfMemoryError<br>-XX:NewRatio=老年代比例分数 来调整新生代老年代比例  <br>-XX:SurivorRatio来调整幸存区与eden的比例    默认该值是<span class="hljs-number">8</span>，即Egen：from：to=<span class="hljs-number">8</span>：<span class="hljs-number">1</span>：<span class="hljs-number">1</span><br>-XX:PretenureSizeThreshold=字节数：配置超过大对象内存参数直接进入老年代<br>-XX:MaxTenuringThreshold=数字：任意对象到达复制次数进入老年代 默认<span class="hljs-number">15</span><br>-XX:MaxMetaspaceSize：最大元空间大小，默认为unlimited(只受系统内存限制)<br>-Xss设置每个线程的堆栈⼤⼩。<br>-XX:MaxPermSize设置永久代最⼤空间⼤⼩<br>-XX:PermSize设置永久代最⼩空间⼤⼩。<br>-XX:MaxNewSize设置新⽣代最⼤空间⼤⼩。<br>-XX:NewSize设置新⽣代最⼩空间⼤⼩。<br>-Xmn堆中新⽣代初始及最⼤⼤⼩（NewSize和MaxNewSize为其细化）。<br></code></pre></td></tr></table></figure>

<h4 id="OOM诊断"><a href="#OOM诊断" class="headerlink" title="OOM诊断"></a>OOM诊断</h4><h5 id="常见OOM问题"><a href="#常见OOM问题" class="headerlink" title="常见OOM问题"></a>常见OOM问题</h5><blockquote>
<p>运行时常量池导致的溢出，设置持久代内存-XX:MaxPermSize参数，通常可以解决OOM</p>
<p>超过虚拟机允许大小的内存，出现OOM</p>
<p>堆内存空间不足，设置heapspace XMx参数增加堆内存，通常可以解决OOM</p>
</blockquote>
<h5 id="概述：-2"><a href="#概述：-2" class="headerlink" title="概述："></a>概述：</h5><p><strong>在⼀个项⽬中，突然出现了OOM故障，那么该如何排除~</strong></p>
<p><strong>研究为什么出错 能够看到代码第⼏⾏出错：</strong></p>
<ul>
<li><p>内存快照分析⼯具：(ECLIPSE)MAT、Jprofiler </p>
</li>
<li><p>Debug，⼀⾏⾏分析代码，项目上线时无法使用</p>
</li>
</ul>
<h5 id="MAT、Jprofiler作⽤"><a href="#MAT、Jprofiler作⽤" class="headerlink" title="MAT、Jprofiler作⽤"></a>MAT、Jprofiler作⽤</h5><ul>
<li>分析Dump内存⽂件,快速定位内存泄露 </li>
<li>获得堆中的数据 </li>
<li>获得⼤的对象 ……</li>
</ul>
<h5 id="处理方法："><a href="#处理方法：" class="headerlink" title="处理方法："></a>处理方法：</h5><ol>
<li><p>尝试扩⼤堆内存看结果 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">-Xms1m -Xmx8m<br></code></pre></td></tr></table></figure></li>
<li><p>若仍有问题，就要分析内存，看⼀下那个地⽅出现了问题（专业⼯具）jprofier、</p>
</li>
<li><p>没问题，就是内存太小，调整即可</p>
</li>
</ol>
<h5 id="测试：-1"><a href="#测试：-1" class="headerlink" title="测试："></a>测试：</h5><h6 id="代码：-2"><a href="#代码：-2" class="headerlink" title="代码："></a>代码：</h6><figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs haxe"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeapTest</span> </span>&#123;<br><span class="hljs-comment">//    -Xms8m -Xmx8m -XX:+PrintGCDetails</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> void main(<span class="hljs-keyword">String</span>[] args) &#123;<br>        <span class="hljs-keyword">String</span> s=<span class="hljs-string">&quot;asdhjkhjl;dsjvl;k&quot;</span>;<br>        <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>            s+=s+<span class="hljs-keyword">new</span> <span class="hljs-type">Random</span>().nextInt(<span class="hljs-number">888888888</span>)+<span class="hljs-keyword">new</span> <span class="hljs-type">Random</span>().nextInt(<span class="hljs-number">999999999</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h6 id="配置参数："><a href="#配置参数：" class="headerlink" title="配置参数："></a>配置参数：</h6><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516183041586.png" srcset="/img/loading.gif" lazyload alt="image-20210516183041586"></p>
<h6 id="运行情况："><a href="#运行情况：" class="headerlink" title="运行情况："></a>运行情况：</h6><p><strong>不配置参数：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java">Exception in thread <span class="hljs-string">&quot;main&quot;</span> java.lang.OutOfMemoryError: Java heap space<br>	at java.util.Arrays.copyOf(Arrays.java:<span class="hljs-number">3332</span>)<br>	at java.lang.AbstractStringBuilder.ensureCapacityInternal(AbstractStringBuilder.java:<span class="hljs-number">124</span>)<br>	at java.lang.AbstractStringBuilder.append(AbstractStringBuilder.java:<span class="hljs-number">674</span>)<br>	at java.lang.StringBuilder.append(StringBuilder.java:<span class="hljs-number">208</span>)<br>	at HeapTest.main(HeapTest.java:<span class="hljs-number">15</span>)<br></code></pre></td></tr></table></figure>

<p><strong>配置参数：</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java">[GC (Allocation Failure) [PSYoungGen: 1536K-&gt;504K(2048K)] 1536K-&gt;644K(7680K), <span class="hljs-number">0.0394235</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.04</span> secs] <br>[GC (Allocation Failure) [PSYoungGen: 1913K-&gt;481K(2048K)] 2053K-&gt;936K(7680K), <span class="hljs-number">0.0008421</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[GC (Allocation Failure) [PSYoungGen: 1901K-&gt;344K(2048K)] 2356K-&gt;1625K(7680K), <span class="hljs-number">0.0007762</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[GC (Allocation Failure) [PSYoungGen: 1522K-&gt;408K(2048K)] 3908K-&gt;3345K(7680K), <span class="hljs-number">0.0016787</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[GC (Allocation Failure) [PSYoungGen: 1018K-&gt;472K(2048K)] 5059K-&gt;4513K(7680K), <span class="hljs-number">0.0006704</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[GC (Allocation Failure) [PSYoungGen: 472K-&gt;440K(2048K)] 4513K-&gt;4481K(7680K), <span class="hljs-number">0.0006107</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[<span class="hljs-function">Full <span class="hljs-title">GC</span> <span class="hljs-params">(Allocation Failure)</span> [PSYoungGen: 440K-&gt;0<span class="hljs-title">K</span><span class="hljs-params">(2048K)</span>] [ParOldGen: 4041K-&gt;2252<span class="hljs-title">K</span><span class="hljs-params">(5632K)</span>] 4481K-&gt;2252<span class="hljs-title">K</span><span class="hljs-params">(7680K)</span>, [Metaspace: 3259K-&gt;3259<span class="hljs-title">K</span><span class="hljs-params">(1056768K)</span>], 0.0051779 secs] [Times: user</span>=<span class="hljs-number">0.09</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.01</span> secs] <br>[<span class="hljs-function">Full <span class="hljs-title">GC</span> <span class="hljs-params">(Ergonomics)</span> [PSYoungGen: 1147K-&gt;0<span class="hljs-title">K</span><span class="hljs-params">(2048K)</span>] [ParOldGen: 5563K-&gt;2802<span class="hljs-title">K</span><span class="hljs-params">(5632K)</span>] 6711K-&gt;2802<span class="hljs-title">K</span><span class="hljs-params">(7680K)</span>, [Metaspace: 3275K-&gt;3275<span class="hljs-title">K</span><span class="hljs-params">(1056768K)</span>], 0.0065831 secs] [Times: user</span>=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.01</span> secs] <br>[GC (Allocation Failure) [PSYoungGen: 60K-&gt;0K(2048K)] 5070K-&gt;5009K(7680K), <span class="hljs-number">0.0003115</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[<span class="hljs-function">Full <span class="hljs-title">GC</span> <span class="hljs-params">(Ergonomics)</span> [PSYoungGen: 0K-&gt;0<span class="hljs-title">K</span><span class="hljs-params">(2048K)</span>] [ParOldGen: 5009K-&gt;3905<span class="hljs-title">K</span><span class="hljs-params">(5632K)</span>] 5009K-&gt;3905<span class="hljs-title">K</span><span class="hljs-params">(7680K)</span>, [Metaspace: 3275K-&gt;3275<span class="hljs-title">K</span><span class="hljs-params">(1056768K)</span>], 0.0068917 secs] [Times: user</span>=<span class="hljs-number">0.09</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.01</span> secs] <br>[GC (Allocation Failure) [PSYoungGen: 0K-&gt;0K(2048K)] 3905K-&gt;3905K(7680K), <span class="hljs-number">0.0003128</span> secs] [Times: user=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.00</span> secs] <br>[<span class="hljs-function">Full <span class="hljs-title">GC</span> <span class="hljs-params">(Allocation Failure)</span> [PSYoungGen: 0K-&gt;0<span class="hljs-title">K</span><span class="hljs-params">(2048K)</span>] [ParOldGen: 3905K-&gt;3886<span class="hljs-title">K</span><span class="hljs-params">(5632K)</span>] 3905K-&gt;3886<span class="hljs-title">K</span><span class="hljs-params">(7680K)</span>, [Metaspace: 3275K-&gt;3275<span class="hljs-title">K</span><span class="hljs-params">(1056768K)</span>], 0.0061927 secs] [Times: user</span>=<span class="hljs-number">0.00</span> sys=<span class="hljs-number">0.00</span>, real=<span class="hljs-number">0.01</span> secs] <br>Heap<br> PSYoungGen      total 2048K, used 64K [<span class="hljs-number">0x00000000ffd80000</span>, <span class="hljs-number">0x0000000100000000</span>, <span class="hljs-number">0x0000000100000000</span>)<br>  eden space 1536K, <span class="hljs-number">4</span>% used [<span class="hljs-number">0x00000000ffd80000</span>,<span class="hljs-number">0x00000000ffd90310</span>,<span class="hljs-number">0x00000000fff00000</span>)<br>  from space 512K, <span class="hljs-number">0</span>% used [<span class="hljs-number">0x00000000fff80000</span>,<span class="hljs-number">0x00000000fff80000</span>,<span class="hljs-number">0x0000000100000000</span>)<br>  to   space 512K, <span class="hljs-number">0</span>% used [<span class="hljs-number">0x00000000fff00000</span>,<span class="hljs-number">0x00000000fff00000</span>,<span class="hljs-number">0x00000000fff80000</span>)<br> ParOldGen       total 5632K, used 3886K [<span class="hljs-number">0x00000000ff800000</span>, <span class="hljs-number">0x00000000ffd80000</span>, <span class="hljs-number">0x00000000ffd80000</span>)<br>  object space 5632K, <span class="hljs-number">68</span>% used [<span class="hljs-number">0x00000000ff800000</span>,<span class="hljs-number">0x00000000ffbcb838</span>,<span class="hljs-number">0x00000000ffd80000</span>)<br> Metaspace       used 3333K, capacity 4496K, committed 4864K, reserved 1056768K<br>  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">space</span>    <span class="hljs-title">used</span> 362<span class="hljs-title">K</span>, <span class="hljs-title">capacity</span> 388<span class="hljs-title">K</span>, <span class="hljs-title">committed</span> 512<span class="hljs-title">K</span>, <span class="hljs-title">reserved</span> 1048576<span class="hljs-title">K</span></span><br><span class="hljs-class"><span class="hljs-title">Exception</span> <span class="hljs-title">in</span> <span class="hljs-title">thread</span> &quot;<span class="hljs-title">main</span>&quot; <span class="hljs-title">java</span>.<span class="hljs-title">lang</span>.<span class="hljs-title">OutOfMemoryError</span>: <span class="hljs-title">Java</span> <span class="hljs-title">heap</span> <span class="hljs-title">space</span></span><br><span class="hljs-class">	<span class="hljs-title">at</span> <span class="hljs-title">java</span>.<span class="hljs-title">util</span>.<span class="hljs-title">Arrays</span>.<span class="hljs-title">copyOf</span>(<span class="hljs-title">Arrays</span>.<span class="hljs-title">java</span>:3332)</span><br><span class="hljs-class">	<span class="hljs-title">at</span> <span class="hljs-title">java</span>.<span class="hljs-title">lang</span>.<span class="hljs-title">AbstractStringBuilder</span>.<span class="hljs-title">ensureCapacityInternal</span>(<span class="hljs-title">AbstractStringBuilder</span>.<span class="hljs-title">java</span>:124)</span><br><span class="hljs-class">	<span class="hljs-title">at</span> <span class="hljs-title">java</span>.<span class="hljs-title">lang</span>.<span class="hljs-title">AbstractStringBuilder</span>.<span class="hljs-title">append</span>(<span class="hljs-title">AbstractStringBuilder</span>.<span class="hljs-title">java</span>:674)</span><br><span class="hljs-class">	<span class="hljs-title">at</span> <span class="hljs-title">java</span>.<span class="hljs-title">lang</span>.<span class="hljs-title">StringBuilder</span>.<span class="hljs-title">append</span>(<span class="hljs-title">StringBuilder</span>.<span class="hljs-title">java</span>:208)</span><br><span class="hljs-class">	<span class="hljs-title">at</span> <span class="hljs-title">HeapTest</span>.<span class="hljs-title">main</span>(<span class="hljs-title">HeapTest</span>.<span class="hljs-title">java</span>:15)</span><br><span class="hljs-class"><span class="hljs-title">Process</span> <span class="hljs-title">finished</span> <span class="hljs-title">with</span> <span class="hljs-title">exit</span> <span class="hljs-title">code</span> 1</span><br></code></pre></td></tr></table></figure>

<ul>
<li>年轻代，老年代都走不动了，无法清理了，爆出OOM</li>
</ul>
<h4 id="Jprofiler"><a href="#Jprofiler" class="headerlink" title="Jprofiler"></a>Jprofiler</h4><h5 id="测试代码："><a href="#测试代码：" class="headerlink" title="测试代码："></a>测试代码：</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * Dump</span><br><span class="hljs-comment"> *  -Xms设置初始化内存分配⼤⼩,1/64</span><br><span class="hljs-comment"> *  -Xmx设置最⼤分配内存,默认1/4</span><br><span class="hljs-comment"> * -XX:+PrintGCDetails //打印GC垃圾回收信息</span><br><span class="hljs-comment"> * -XX:+HeapDumpOnOutOfMemoryError //oom DUMP</span><br><span class="hljs-comment"> * -Xms1m -Xmx8m -XX:+HeapDumpOnOutOfMemoryError</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HeapTest3</span> </span>&#123;<br>    <span class="hljs-keyword">byte</span>[] array = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">1</span>*<span class="hljs-number">1024</span>*<span class="hljs-number">1024</span>]; <span class="hljs-comment">// 1m</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>&#123;<br>        ArrayList&lt;HeapTest3&gt; list = <span class="hljs-keyword">new</span> ArrayList&lt;&gt;();<br>        <span class="hljs-keyword">int</span> count = <span class="hljs-number">0</span>;<br>         <span class="hljs-keyword">try</span> &#123;<br>             <span class="hljs-keyword">while</span> (<span class="hljs-keyword">true</span>) &#123;<br>                list.add(<span class="hljs-keyword">new</span> HeapTest3());<span class="hljs-comment">//错误位置</span><br>                 count++;<br>                &#125;<br>             &#125; <span class="hljs-keyword">catch</span> (Error e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;count:&quot;</span>+count);<br>            e.printStackTrace();<br>         &#125;<br>        <span class="hljs-comment">// Throwable</span><br>         <span class="hljs-comment">// Exception</span><br>        <span class="hljs-comment">// error</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h5 id="配置参数–Dump文件"><a href="#配置参数–Dump文件" class="headerlink" title="配置参数–Dump文件"></a>配置参数–Dump文件</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516184714249.png" srcset="/img/loading.gif" lazyload alt="image-20210516184714249"></p>
<h5 id="软件分析"><a href="#软件分析" class="headerlink" title="软件分析"></a>软件分析</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516184809000.png" srcset="/img/loading.gif" lazyload alt="image-20210516184809000"></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516184836248.png" srcset="/img/loading.gif" lazyload alt="image-20210516184836248"></p>
<h2 id="8、垃圾回收"><a href="#8、垃圾回收" class="headerlink" title="8、垃圾回收"></a>8、垃圾回收</h2><h3 id="概述：-3"><a href="#概述：-3" class="headerlink" title="概述："></a>概述：</h3><p><strong>==GC(Garbage collection)==</strong></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516214215293.png" srcset="/img/loading.gif" lazyload alt="image-20210516214215293"></p>
<p><strong>jvm在进行Garbage collection回收时，并不是对三个区域统一回收，大部分时候，只针对新生代</strong></p>
<ul>
<li>新生代</li>
<li>幸存区(from,to)</li>
<li>老年代</li>
</ul>
<h4 id="GC两种类型："><a href="#GC两种类型：" class="headerlink" title="GC两种类型："></a>GC两种类型：</h4><ul>
<li>轻gc(minor)–新生代</li>
<li>重GC(FULL)–老年代</li>
</ul>
<h4 id="GC-garbage-collection-面试题："><a href="#GC-garbage-collection-面试题：" class="headerlink" title="GC(garbage collection)面试题："></a>GC(garbage collection)面试题：</h4><ul>
<li>JVM的内存模型和分区~详细到每个区放什么？ </li>
<li>堆⾥⾯的分区有哪些？(Eden、form、to、⽼年区），说说它们的特点。 </li>
<li>GC的算法有哪些？标记清除法，标记压缩，复制算法，引⽤计数，怎么⽤的？ </li>
<li>轻GC和重GC分别在什么时候发⽣？    </li>
</ul>
<blockquote>
<p>轻GC发生在年轻代，</p>
<p>重GC发生情况：</p>
<ol>
<li>老年代满</li>
<li>持久代满</li>
<li>System.gc()</li>
<li>CMS GC出现promotion failed和concurrent mode failure,可能会触发FULLGC</li>
</ol>
<ul>
<li>promotion failed轻gc时幸存区放不下，只能放入老年代，但老年代也放不下</li>
<li>concurrent mode failure 在执行CMSGC的过程中同时有对象要放入老年代，但此时老年代的空间不足</li>
</ul>
<ol start="5">
<li>统计得到的MinorGC晋升到老年代的平均大小大于老年代的剩余空间</li>
</ol>
<p>注意：RMI来进行RPC或管理的sun jdk应用而言，默认情况会一小时执行一次Full GC，但可调配</p>
<ul>
<li>-java-Dsun.rmi.dgc.client.gcinterval=值 FULL GC执行间隔时间</li>
<li>XX:+DisableExplicitGC 禁止RMI调用System.gc()</li>
</ul>
</blockquote>
<h3 id="GC常用算法："><a href="#GC常用算法：" class="headerlink" title="GC常用算法："></a>GC常用算法：</h3><h4 id="1、引用计数法"><a href="#1、引用计数法" class="headerlink" title="1、引用计数法"></a>1、引用计数法</h4><p><strong>==拥有一个计数器==</strong></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516220240754.png" srcset="/img/loading.gif" lazyload alt="image-20210516220240754"></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/toyijiu/article/details/80309970">参考资料</a></p>
<p><strong>一般不使用</strong></p>
<h4 id="2、复制算法"><a href="#2、复制算法" class="headerlink" title="2、复制算法"></a>2、复制算法</h4><h5 id="概述：-4"><a href="#概述：-4" class="headerlink" title="概述："></a>概述：</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516222541317.png" srcset="/img/loading.gif" lazyload alt="image-20210516222541317"></p>
<h5 id="过程："><a href="#过程：" class="headerlink" title="过程："></a>过程：</h5><ol>
<li><p><strong>初始阶段</strong>：</p>
<p><img src="F:%5C%E8%B5%84%E6%96%99%5Cmd%5CJVM.assets%5Cimage-20210516223515709.png" srcset="/img/loading.gif" lazyload alt="image-20210516223515709"></p>
</li>
<li><p><strong>调换from与to区</strong></p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516223616871.png" srcset="/img/loading.gif" lazyload alt="image-20210516223616871"></p>
</li>
<li><p>**==达到最大复制次数==**，坚持下来的入永久，其他结束使命</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516223745832.png" srcset="/img/loading.gif" lazyload alt="image-20210516223745832"></p>
</li>
</ol>
<h5 id="优缺点："><a href="#优缺点：" class="headerlink" title="优缺点："></a>优缺点：</h5><h6 id="优点："><a href="#优点：" class="headerlink" title="优点："></a>优点：</h6><ul>
<li>没有多余的内存碎片</li>
<li>新生代极为适合的一种算法</li>
</ul>
<h6 id="缺点："><a href="#缺点：" class="headerlink" title="缺点："></a>缺点：</h6><ul>
<li>to始终为空，浪费了内存空间</li>
<li>假设对象100%存活，（极端情况），OOM</li>
</ul>
<p><a href="%5BGC_4_GC%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95_%E4%BC%8D%E5%8F%B6%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2_gc%E5%A4%8D%E5%88%B6%E7%AE%97%E6%B3%95%5D(https://blog.csdn.net/u014228375/article/details/68957510)">参考资料</a></p>
<p><strong>==最佳使用场景：对象存活度较低的新生区==</strong></p>
<h4 id="3、标记清除算法"><a href="#3、标记清除算法" class="headerlink" title="3、标记清除算法"></a>3、标记清除算法</h4><h5 id="标记"><a href="#标记" class="headerlink" title="标记"></a>标记</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516230340352.png" srcset="/img/loading.gif" lazyload alt="image-20210516230340352"></p>
<h5 id="清除："><a href="#清除：" class="headerlink" title="清除："></a>清除：</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516230402871.png" srcset="/img/loading.gif" lazyload alt="image-20210516230402871"></p>
<p>优点：不需要额外的空间。 </p>
<p>缺点：两次扫描，严重浪费时间，会产⽣内存碎⽚。</p>
<p>[参考](<a target="_blank" rel="noopener" href="https://www.cnblogs.com/leisurelylicht/p/GC-biao-jiqing-chu-suan-fa-Mark-Sweep-GC.html">1. GC标记-清除算法(Mark Sweep GC) - 暮晨 - 博客园 (cnblogs.com)</a>)</p>
<h4 id="4、标记压缩算法"><a href="#4、标记压缩算法" class="headerlink" title="4、标记压缩算法"></a>4、标记压缩算法</h4><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516230859330.png" srcset="/img/loading.gif" lazyload alt="image-20210516230859330"></p>
<h5 id="先标记清除多次"><a href="#先标记清除多次" class="headerlink" title="先标记清除多次"></a>先标记清除多次</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516231015051.png" srcset="/img/loading.gif" lazyload alt="image-20210516231015051"></p>
<h5 id="再统一压缩"><a href="#再统一压缩" class="headerlink" title="再统一压缩"></a>再统一压缩</h5><p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516231211943.png" srcset="/img/loading.gif" lazyload alt="image-20210516231211943"></p>
<p><a href="%5BJVM%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95%E7%90%86%E8%A7%A32%E4%B9%8B%E6%A0%87%E8%AE%B0%E6%B8%85%E9%99%A4%E7%AE%97%E6%B3%95%E5%92%8C%E6%A0%87%E8%AE%B0%E5%8E%8B%E7%BC%A9%E7%AE%97%E6%B3%95_wang_chao_yang%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2%5D(https://blog.csdn.net/wang_chao_yang/article/details/106464368)">参考:</a></p>
<h3 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h3><ul>
<li><p>内存效率：复制算法&gt;标记清除算法&gt;标记压缩(时间复杂度)</p>
</li>
<li><p>内存整齐度：复制算法=标记压缩&gt;标记清除</p>
</li>
<li><p>内存利用率：标记压缩=标记清除&gt;复制算法</p>
</li>
<li><p>没有最优，只有最合适的，GC也称为==分代收集==算法</p>
</li>
<li><p>年轻代：</p>
<ul>
<li>存活率低</li>
<li>复制算法</li>
</ul>
</li>
<li><p>老年代：</p>
<ul>
<li>区域大，存活率高</li>
<li>标记清除(内存碎片不是太多)+标记压缩(内存碎片到达一定量级)混合实现</li>
</ul>
</li>
</ul>
<p>[参考:]([<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/1112712c6b92">转]六、GC算法精解（五分钟教你终极算法—分代搜集算法） - 简书 (jianshu.com)</a>)</p>
<h2 id="9、JMM"><a href="#9、JMM" class="headerlink" title="9、JMM"></a>9、JMM</h2><p>==java memory model==</p>
<h3 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h3><ul>
<li>java内存模型(Java Memory Model)</li>
<li>Java的并发采用的是共享内存模型</li>
<li>不存在的东西，虚无的概念，约定</li>
<li>JSR133中指定了JMM是用来定义一个一致的、跨平台的内存模型<ul>
<li>==是缓存一致性协议，用来定义数据读写的规则。==</li>
<li>JSR：JavaSpecification Requests java规范提案，是指向JCP(JavaCommunity Process)提出新增一个标准化技术规范的正式请求。任何人都可以提交JSR，以向Java平台增添新的API和服务。JSR已成为Java界的一个重要标准。简单的就是jsr是java开发者以及授权者指定的标准，而java开发者以及授权者形成一个jcp国际组织。职能是指定java标准。</li>
<li>JCP由SUN于1995年创造Java的非正式过程，演进到如今有数百名来自世界各地Java代表成员一同监督Java发展的正式程序 。<ul>
<li>官方网站是：<a target="_blank" rel="noopener" href="https://www.jcp.org/en/home/index">https://www.jcp.org/en/home/index</a></li>
<li>维护的范围：J2ME、J2SE、J2EE，XML，OSS，JAIN等规范</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="JMM同步约定"><a href="#JMM同步约定" class="headerlink" title="JMM同步约定"></a>JMM同步约定</h3><ol>
<li>线程解锁前，必须把共享变量立刻刷回主存</li>
<li>线程加锁前，必须读取主存中的最新值到工作内存中</li>
<li>解锁和加锁是同一把锁</li>
</ol>
<h3 id="JMM作用"><a href="#JMM作用" class="headerlink" title="JMM作用"></a>JMM作用</h3><ul>
<li><p>缓存⼀致性协议，⽤于定义数据读写的规则（遵守，找到这个规则）。</p>
</li>
<li><p>从抽象的⻆度来看，JMM定义了线程⼯作内存和主内存之间的抽象关系：线程之间的共享变量 存储在主内存（Main Memory)中，每个线程都有⼀个私有的本地内存（LocalMemory)。</p>
<p><img src="https://gitee.com/csdnm/pic-go/raw/master/img/image-20210516233353373.png" srcset="/img/loading.gif" lazyload alt="image-20210516233353373"></p>
</li>
</ul>
<p>==解决共享对象可⻅性这个问题：==</p>
<p>[参考:](<a target="_blank" rel="noopener" href="http://www.hellojava.com/a/77344.html">BAT经典面试题，深入理解Java内存模型JMM - HelloJava菜鸟社区</a>)</p>
<h3 id="学习方式"><a href="#学习方式" class="headerlink" title="学习方式"></a>学习方式</h3><p>JMM：抽象的概念，理论</p>
<h5 id="JMM对这八种指令的使用，制定了如下规则："><a href="#JMM对这八种指令的使用，制定了如下规则：" class="headerlink" title="JMM对这八种指令的使用，制定了如下规则："></a>JMM对这八种指令的使用，制定了如下规则：</h5><ol>
<li>不允许read和load、store和write操作之一单独出现。即使用了read必须load，使用了store必须write</li>
<li>不允许线程丢弃他最近的assign操作，即工作变量的数据改变了之后，必须告知主存</li>
<li>不允许一个线程将没有assign的数据从工作内存同步回主内存 </li>
<li>一个新的变量必须在主内存中诞生，不允许工作内存直接使用一个未被初始化的变量。就是对变量 实施use、store操作之前，必须经过assign和load操作 </li>
<li>一个变量同一时间只有一个线程能对其进行lock。多次lock后，必须执行相同次数的unlock才能解锁</li>
<li>如果对一个变量进行lock操作，会清空所有工作内存中此变量的值，在执行引擎使用这个变量前，必须重新load或assign操作初始化变量的值 </li>
<li>如果一个变量没有被lock，就不能对其进行unlock操作。也不能unlock一个被其他线程锁住的变量 </li>
<li>对一个变量进行unlock操作之前，必须把此变量同步回主内存</li>
</ol>
<ul>
<li>JMM对这⼋种操作规则和对volatile的⼀些特殊规则就能==确定哪⾥操作是线程安全，哪些操作是线程 不安全的==了。</li>
<li>但是这些规则实在复杂，很难在实践中直接分析。所以⼀般我们也不会通过上述规则进⾏分 析。更多的时候，使⽤java的happen-before规则来进⾏分析。</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Hexo/">Hexo</a>
                    
                      <a class="hover-with-bg" href="/tags/fluid/">fluid</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/08/20/JDBC/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">JDBC笔记</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/08/19/hello-world/">
                        <span class="hidden-mobile">Hello World</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
